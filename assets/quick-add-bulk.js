customElements.get("quick-add-bulk")||customElements.define("quick-add-bulk",class extends HTMLElement{constructor(){super();var t=debounce(t=>{0===parseInt(t.target.dataset.cartQuantity)?this.addToCart(t):this.updateCart(t)},ON_CHANGE_DEBOUNCE_TIMER),t=(this.addEventListener("change",t.bind(this)),this.listenForActiveInput(),this.listenForKeydown(),this.lastActiveInputId=null,new URLSearchParams(window.location.search));window.pageNumber=decodeURIComponent(t.get("page")||"")}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,t=>{"quick-add"!==t.source&&this.onCartUpdate().then(()=>{this.listenForActiveInput(),this.listenForKeydown()})})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}getInput(){return this.querySelector("quantity-input input")}selectProgressBar(){return this.querySelector(".progress-bar-container")}listenForActiveInput(){this.classList.contains("hidden")||this.getInput().addEventListener("focusin",t=>t.target.select()),this.isEnterPressed=!1}listenForKeydown(){this.getInput().addEventListener("keydown",t=>{"Enter"===t.key&&(this.getInput().blur(),this.isEnterPressed=!0)})}resetQuantityInput(t){t=document.getElementById(t);t.value=t.getAttribute("value"),this.isEnterPressed=!1}cleanErrorMessageOnType(t){t.target.addEventListener("keypress",()=>{t.target.setCustomValidity("")},{once:!0})}onCartUpdate(){return new Promise((e,s)=>{fetch(this.getSectionsUrl()+"?section_id="+this.closest(".collection").dataset.id).then(t=>t.text()).then(t=>{t=(new DOMParser).parseFromString(t,"text/html").querySelector(`#quick-add-bulk-${this.dataset.id}-`+this.closest(".collection").dataset.id);t&&(this.innerHTML=t.innerHTML),e()}).catch(t=>{console.error(t),s(t)})})}updateCart(e){this.lastActiveInputId=e.target.getAttribute("data-index"),this.quantity=this.querySelector("quantity-input"),this.quantity.classList.add("quantity__input-disabled"),this.selectProgressBar().classList.remove("hidden");var t=JSON.stringify({quantity:e.target.value,id:e.target.getAttribute("data-index"),sections:this.getSectionsToRender().map(t=>t.section),sections_url:this.getSectionsUrl()});fetch(""+routes.cart_change_url,{...fetchConfig("javascript"),body:t}).then(t=>t.text()).then(t=>{t=JSON.parse(t);t.description||t.errors?(e.target.setCustomValidity(t.description),e.target.reportValidity(),this.resetQuantityInput(e.target.id),this.selectProgressBar().classList.add("hidden"),e.target.select(),this.cleanErrorMessageOnType(e)):(this.renderSections(t),publish(PUB_SUB_EVENTS.cartUpdate,{source:"quick-add",cartData:t}))}).catch(t=>{console.log(t,"error")})}addToCart(e){this.selectProgressBar().classList.remove("hidden"),this.lastActiveInputId=e.target.getAttribute("data-index");var t=JSON.stringify({items:[{quantity:parseInt(e.target.value),id:parseInt(this.dataset.id)}],sections:this.getSectionsToRender().map(t=>t.section)});fetch(""+routes.cart_add_url,{...fetchConfig("javascript"),body:t}).then(t=>t.text()).then(t=>{t=JSON.parse(t);t.description||t.errors?(e.target.setCustomValidity(t.description),e.target.reportValidity(),this.resetQuantityInput(e.target.id),this.selectProgressBar().classList.add("hidden"),this.quantity.classList.remove("quantity__input-disabled"),e.target.select(),this.cleanErrorMessageOnType(e)):(this.renderSections(t),publish(PUB_SUB_EVENTS.cartUpdate,{source:"quick-add",cartData:t}))}).catch(t=>{console.error(t)})}getSectionsToRender(){return[{id:`quick-add-bulk-${this.dataset.id}-`+this.closest(".collection").dataset.id,section:this.closest(".collection").dataset.id,selector:`#quick-add-bulk-${this.dataset.id}-`+this.closest(".collection").dataset.id},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"CartDrawer",selector:"#CartDrawer",section:"cart-drawer"}]}getSectionsUrl(){return window.pageNumber?window.location.pathname+"?page="+window.pageNumber:""+window.location.pathname}getSectionInnerHTML(t,e){return(new DOMParser).parseFromString(t,"text/html").querySelector(e).innerHTML}renderSections(s){this.getSectionsToRender().forEach(t=>{var e=document.getElementById(t.id),e=(e&&e.parentElement&&e.parentElement.classList.contains("drawer")&&(0<s.items.length?e.parentElement.classList.remove("is-empty"):e.parentElement.classList.add("is-empty"),setTimeout(()=>{document.querySelector("#CartDrawer-Overlay").addEventListener("click",this.cart.close.bind(this.cart))})),e&&e.querySelector(t.selector)?e.querySelector(t.selector):e);e&&(e.innerHTML=this.getSectionInnerHTML(s.sections[t.section],t.selector))}),this.isEnterPressed&&this.querySelector("#Quantity-"+this.lastActiveInputId).select(),this.listenForActiveInput(),this.listenForKeydown()}});